<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Algorithm¬†1 Top Pick Sidebar</title>
  <style>
    html, body { margin:0; padding:0; font-family:sans-serif; }
    #top-pick-sidebar {
      position: fixed;
      top: 20px;
      right: 0;
      width: 280px;
      background: #fafafa;
      border-left: 1px solid #ddd;
      padding: 15px;
      box-shadow: -2px 0 5px rgba(0,0,0,0.1);
      line-height: 1.5;
    }
    #top-pick-sidebar h2 { margin-top:0; font-size:18px; color:#333; }
    #top-pick-sidebar .logo { display:block; max-height:40px; margin-bottom:10px; }
    #top-pick-sidebar .company-name { font-weight:bold; font-size:16px; margin-bottom:5px; }
    #top-pick-sidebar .rank { color:#555; margin-bottom:15px; }
    #top-pick-sidebar .description { font-size:14px; color:#444; }
  </style>
</head>
<body>

  <aside id="top-pick-sidebar">
    <h2>One Top Pick For You</h2>
    <img class="logo" src="" alt="Company logo">
    <div class="company-name"></div>
    <div class="rank"></div>
    <p class="description">
      At Victor Philip, we believe in evaluating companies from ALL sides. Stable and accelerating growth, a valuation that is not too high, a quality return on invested capital, a robust balance sheet and cash flow stream, a positive sentiment score (we don't want a company with a CEO in jail), an industry that is in momentum and preferably the company being under the radar. <span class="company-name-inline"></span> scores high on all these characteristics. Hence, it is one of our top picks of the week!
    </p>
  </aside>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      fetch("example_holding.json")
        .then(res => {
          console.log("üëâ example_holding.json status:", res.status);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(data => {
          if (!Array.isArray(data) || data.length === 0) {
            throw new Error("No holdings data in JSON");
          }

          // Pick the smallest rank value
          let top = data.reduce((best, curr) => curr.rank < best.rank ? curr : best, data[0]);

          // Strip off any country code suffix (e.g. "FAA:DEU" ‚Üí "FAA")
          const rawTicker = top.baseTicker || "";
          const ticker = rawTicker.split(":")[0];

          // Resolve logo URL, prefer thumbnails.small, else the main file url
          let logoUrl = "";
          if (typeof top.logo === "string" && top.logo.trim()) {
            logoUrl = top.logo;
          } else if (Array.isArray(top.logo) && top.logo.length > 0) {
            const file = top.logo[0];
            logoUrl = (file.thumbnails?.small?.url) || file.url || "";
          }

          if (!logoUrl) {
            console.warn("‚ö†Ô∏è No logo URL found for", ticker);
          }

          const sidebar = document.getElementById("top-pick-sidebar");
          sidebar.querySelector("img.logo").src = logoUrl;
          sidebar.querySelector("img.logo").alt = ticker + " logo";
          sidebar.querySelector(".company-name").textContent = ticker;
          sidebar.querySelector(".company-name-inline").textContent = ticker;
          sidebar.querySelector(".rank").textContent =
            "Overall Rank: " + parseFloat(top.rank).toFixed(1);
        })
        .catch(err => {
          console.error("‚ùå Sidebar error:", err);
          document.getElementById("top-pick-sidebar")
                  .innerHTML = "<p>Unable to load top pick at this time.</p>";
        });
    });
  </script>

</body>
</html>
