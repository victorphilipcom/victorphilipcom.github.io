<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>My Tiingo Ticker</title>
  <style>
    /* Basic styling for a scrolling ticker */
    body {
      margin: 0; 
      padding: 0; 
      font-family: sans-serif;
    }
    #ticker-container {
      width: 100%;
      overflow: hidden;         /* hide overflow for the "marquee" effect */
      white-space: nowrap;
      border: 1px solid #ccc;
    }
    #ticker-text {
      display: inline-block;
      padding-left: 100%;       /* start off the right edge */
      animation: scroll-left 15s linear infinite;
      font-size: 16px;
      line-height: 40px;
    }
    @keyframes scroll-left {
      0%   { transform: translate(0, 0); }
      100% { transform: translate(-100%, 0); }
    }

    /* Optional color for gains vs. losses */
    .up   { color: green; }
    .down { color: red;   }
  </style>
</head>
<body>
  <div id="ticker-container">
    <div id="ticker-text">Loading quotes...</div>
  </div>

  <script>
    // This script expects 'data.json' in the *same* folder on GitHub Pages.
    // So your final URL might look like:
    //   https://YOUR_USERNAME.github.io/REPO_NAME/ticker-tiingo.html
    // and your data is at:
    //   https://YOUR_USERNAME.github.io/REPO_NAME/data.json

    fetch("data.json")
      .then(response => {
        // Throw an error if the HTTP status is not "OK"
        if (!response.ok) {
          throw new Error(`Network response was not OK: ${response.status} ${response.statusText}`);
        }
        return response.json();
      })
      .then(quotes => {
        // The array in data.json has objects like:
        // {
        //   "ticker": "AAPL",
        //   "prevClose": 214.1,
        //   "price": 218.27,
        //   ...
        // }

        // For each quote, build a snippet: "AAPL: $218.27 (+4.17)"
        const tickerItems = quotes.map(q => {
          const symbol = q.ticker;
          const price = q.price ?? 0;       // fallback to 0 if somehow undefined
          const prev  = q.prevClose ?? 0;   // fallback to 0 if no prevClose

          // Calculate difference
          const diff    = price - prev;
          const diffStr = diff.toFixed(2);
          const sign    = diff >= 0 ? "+" : "";  // add "+" for positive changes
          
          // Assign CSS class for color
          const cssClass = diff > 0 ? 'up'
                           : diff < 0 ? 'down'
                           : '';

          // Example output: "AAPL: $218.27 (+4.17)"
          return `<span class="${cssClass}">${symbol}: $${price.toFixed(2)} (${sign}${diffStr})</span>`;
        });

        // Join them with a separator
        document.getElementById('ticker-text').innerHTML = tickerItems.join('  |  ');
      })
      .catch(err => {
        console.error("Failed to load quotes:", err);
        document.getElementById('ticker-text').textContent = "Error loading quotes...";
      });
  </script>
</body>
</html>
