<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>My Tiingo Ticker</title>
  <style>
    /* Basic styling for a scrolling ticker */
    body {
      margin: 0; 
      padding: 0; 
      font-family: sans-serif;
    }
    #ticker-container {
      width: 100%;
      overflow: hidden;         
      white-space: nowrap;
      border: 1px solid #ccc;
    }
    #ticker-text {
      display: inline-block;
      /* Increase from 15s to 30s for slower scroll */
      padding-left: 100%;       
      animation: scroll-left 30s linear infinite;
      font-size: 16px;
      line-height: 40px;
    }
    @keyframes scroll-left {
      0%   { transform: translate(0, 0); }
      100% { transform: translate(-100%, 0); }
    }

    /* We want the symbol & price in black, only the difference in green/red */
    .symbol {
      color: black;
      font-weight: bold;
    }
    .price {
      color: black;
    }
    .up   { color: green; }
    .down { color: red;   }
  </style>
</head>
<body>
  <div id="ticker-container">
    <div id="ticker-text">Loading quotes...</div>
  </div>

  <script>
    /*
      Optional: A dictionary mapping tickers to logo image URLs.
      - In a real project, you'd host these images in your repo or CDN.
      - If a ticker isn't found in 'tickerLogos', we'll show a placeholder or skip the logo.
    */
    const tickerLogos = {
      "AAPL": "https://example.com/logos/aapl.png",
      "TSLA": "https://example.com/logos/tsla.png",
      "MSFT": "https://example.com/logos/msft.png",
      "AMZN": "https://example.com/logos/amzn.png",
      "GOOGL": "https://example.com/logos/googl.png",
      // Add more if desired...
    };

    fetch("data.json")
      .then(response => {
        if (!response.ok) {
          throw new Error(`Network response was not OK: ${response.status} ${response.statusText}`);
        }
        return response.json();
      })
      .then(quotes => {
        // Example object in data.json:
        // {
        //   "ticker": "AAPL",
        //   "prevClose": 214.1,
        //   "price": 218.27,
        //   ...
        // }

        // Build each ticker display item
        const tickerItems = quotes.map(q => {
          const symbol = q.ticker;
          const price = q.price ?? 0;       // Our main price field (from 'jq')
          const prev  = q.prevClose ?? 0;

          // Calculate absolute diff & percentage
          const diff = price - prev;
          const pct  = (prev !== 0) ? (diff / prev) * 100 : 0;
          
          const sign     = diff >= 0 ? "+" : "";
          const absDiff  = Math.abs(diff).toFixed(2);
          const pctDiff  = Math.abs(pct).toFixed(2);

          // Decide color class for difference
          const cssClass = diff > 0 ? 'up'
                        : diff < 0 ? 'down'
                        : '';

          // Create an <img> for the logo if we have one
          let logoHtml = "";
          if (tickerLogos[symbol]) {
            logoHtml = `<img src="${tickerLogos[symbol]}" alt="${symbol} logo" style="height:20px; vertical-align:middle; margin-right:5px;">`;
          }

          // Example final text:
          // "AAPL 218.27 +4.17 (+1.95%)"
          return `
            <span class="ticker-item">
              ${logoHtml}
              <span class="symbol">${symbol}</span>
              <span class="price"> ${price.toFixed(2)}</span>
              <span class="${cssClass}">
                ${sign}${absDiff} (${sign}${pctDiff}%)
              </span>
            </span>
          `;
        });

        // Join them with " | " as a separator
        document.getElementById('ticker-text').innerHTML = tickerItems.join(' | ');
      })
      .catch(err => {
        console.error("Failed to load quotes:", err);
        document.getElementById('ticker-text').textContent = "Error loading quotes...";
      });
  </script>
</body>
</html>
